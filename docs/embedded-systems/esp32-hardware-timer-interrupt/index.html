<!doctype html><html lang=en-US><head><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css rel=stylesheet><link integrity="sha512-SJw7jzjMYJhsEnN/BuxTWXkezA2cRanuB8TdCNMXFJjxG9ZGSKOX5P3j03H6kdMxalKHZ7vlBMB4CagFP/de0A==" crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.1.1/css/hover-min.css referrerpolicy=no-referrer rel=stylesheet><link integrity="sha512-RliK2gk03WxUELn57ddjWLhEfhUiOZ85VvWLImFy8A7FOPMkF4Z9YGQ3VKX5jpwkEerAL6I0nC+JNeCPrxWBTw==" crossorigin=anonymous href=https://cdnjs.cloudflare.com/ajax/libs/csshake/1.5.3/csshake.min.css referrerpolicy=no-referrer rel=stylesheet><script integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><link href=https://obsidian-zola.trwbox.com/main.css rel=stylesheet><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>ESP32 Hardware Timer Interrupt | Trent's Second ðŸ§ </title><meta name=description><link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/esp32-hardware-timer-interrupt/ rel=canonical><script type=application/ld+json>
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position":  1 ,
        "name": "Home",
        "item": "https://obsidian-zola.trwbox.com/"
      }
    ]
  }
</script><meta content=#fff name=theme-color><link href=https://obsidian-zola.trwbox.com/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://obsidian-zola.trwbox.com/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://obsidian-zola.trwbox.com/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link crossorigin=anonymous href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB rel=stylesheet><script crossorigin=anonymous defer integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js></script><script crossorigin=anonymous defer integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded", function() {
		renderMathInElement(document.body, {
		delimiters: [
			{left: '$$', right: '$$', display: true},
			{left: '$', right: '$', display: false},
		],
		throwOnError : false
		});
	});</script><body class="docs single"><script>if (localStorage.getItem("theme") === "dark" || (!localStorage.getItem("theme") && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      document.body.classList.add("dark");
    }</script><script>alert("Hello World!");</script><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" id=menu-btn type=checkbox><label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://obsidian-zola.trwbox.com/>Trent's 2<sup>nd</sup> <span class=hvr-pulse>ðŸ§ </span>, curtosey of Peter</a><button aria-label="Toggle mode" class="btn btn-link order-2 order-md-4" id=mode type=button><span class=toggle-dark><svg class="feather feather-moon" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span> <span class=toggle-light><svg class="feather feather-sun" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=5></circle><line x1=12 x2=12 y1=1 y2=3></line><line x1=12 x2=12 y1=21 y2=23></line><line x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line x1=1 x2=3 y1=12 y2=12></line><line x1=21 x2=23 y1=12 y2=12></line><line x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg></span></button><ul class="navbar-nav fork-me order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/trwbox/obsidian-test-vault><svg class="feather feather-github" viewbox="0 0 24 24" fill=none height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input aria-label="Search docs..." class="form-control is-search" placeholder="Search docs..." autocomplete=off id=userinput type=search><div class="shadow bg-white rounded" id=suggestions></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav aria-label="Main navigation" class=docs-links><h3 class=collapsible-section>root</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/home/>Home</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/readme/>README</a></ul></div><h3 class=collapsible-section>3D Printing</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/3d-printing/cool-filaments/>Cool Filaments</a></ul></div><h4 class=collapsible-section>ðŸ‘‰3D Models</h4><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/3d-printing/3d-models/gear-and-belt-generators/>Gear And Belt Generators</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/3d-printing/3d-models/motors/>Motors</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/3d-printing/3d-models/prusa-mini-customization/>Prusa Mini Customization</a></ul></div><h4 class=collapsible-section>ðŸ‘‰Firmware</h4><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/3d-printing/firmware/klipper-on-mpmd-v1/>Klipper On MPMD V1</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/3d-printing/firmware/octoprint/>Octoprint</a></ul></div><h3 class=collapsible-section>Embedded Systems</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/allwinner-d1s/>Allwinner D1s</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/antenna-on-pcb/>Antenna On PCB</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/chips/>Chips</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/embedded-linux/>Embedded Linux</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/esp32/>ESP32</a><li><a class="docs-link active" href=https://obsidian-zola.trwbox.com/docs/embedded-systems/esp32-hardware-timer-interrupt/>ESP32 Hardware Timer Interrupt</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/esp32-c3/>ESP32-C3</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/fpga-stuff/>FPGA Stuff</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/general-pcb-design/>General PCB Design</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/high-speed-pcb-design/>High-Speed PCB Design</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/pcb-manufacturing/>PCB Manufacturing</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/embedded-systems/sipeed-m1w/>Sipeed M1W</a></ul></div><h3 class=collapsible-section>Lists</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/cool-skills-that-i-do-not-possess/>Cool Skills That I Do Not Possess</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/fancy-recipes/>Fancy Recipes</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/machines-wishlist/>Machines Wishlist</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/practical-skills-in-dealing-with-people/>Practical Skills In Dealing With People</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/quotes/>Quotes</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/singapore-restaurants/>Singapore Restaurants</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/lists/stuff-to-read/>Stuff To Read</a></ul></div><h3 class=collapsible-section>Miscellaneous</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/miscellaneous/electromagnetism/>Electromagnetism</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/miscellaneous/linux-tricks/>Linux Tricks</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/miscellaneous/microsoft-office-tricks/>Microsoft Office Tricks</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/miscellaneous/renovation-nonos/>Renovation Nonos</a></ul></div><h3 class=collapsible-section>Operating System</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/operating-system/file-system/>File System</a></ul></div><h3 class=collapsible-section>Tinkering</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tinkering/project-inspirations/>Project Inspirations</a></ul></div><h3 class=collapsible-section>Useful (Online) Tools and Resources</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/useful-online-tools-and-resources/hacks-and-workarounds-outsmarting-rogue-companies/>Hacks And Workarounds (Outsmarting Rogue Companies)</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/useful-online-tools-and-resources/misc/>Misc</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/useful-online-tools-and-resources/powerpoint/>Powerpoint</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/useful-online-tools-and-resources/reseach/>Reseach</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/useful-online-tools-and-resources/software-development/>Software Development</a></ul></div><h3 class=collapsible-section>deep learning</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/adam/>Adam</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/custom-cuda-or-autograd-functions-in-pytorch/>Custom CUDA Or Autograd Functions In PytorchðŸ˜ƒðŸ˜ƒ</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/equalized-learning-rate/>Equalized Learning Rate</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/eureka-concepts/>Eureka Concepts</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/gan-quality-metrics/>GAN Quality Metrics</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/improved-precision-and-recall-metric-for-assessing-generative-models/>Improved Precision And Recall Metric For Assessing Generative Models</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/normalization-techniques/>Normalization Techniques</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/overly-complicated-diagram-of-mlops/>Overly Complicated Diagram Of MLOps</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/papers-to-read/>Papers To Read</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/pixel2style2pixel/>Pixel2Style2Pixel</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/progan/>ProGAN</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/resnet/>ResNet</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/stylegan/>StyleGAN</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/tools/>Tools</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/deep-learning/weight-initialization/>Weight Initialization</a></ul></div><h3 class=collapsible-section>maths</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/maths/conceptual-questions/>Conceptual Questions</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/maths/linear-algebra/>Linear Algebra</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/maths/multiobjective-optimization/>Multiobjective Optimization</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/maths/statistics/>Statistics</a></ul></div><h3 class=collapsible-section>misc</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/misc/electromagnetism/>Electromagnetism</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/misc/minidelta-tuning/>MiniDelta Tuning</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/misc/renovation-nonos/>Renovation Nonos</a></ul></div><h3 class=collapsible-section>obsidian-zola tests</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/obsidian-zola-tests/line-breaks/>Line Breaks</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/obsidian-zola-tests/repeat-name-nested/>Repeat Name</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/obsidian-zola-tests/weird-filename/>Weird_@Filename_% $^}{+=-_~`&()!'</a></ul></div><h4 class=collapsible-section>ðŸ‘‰repeat name</h4><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/obsidian-zola-tests/repeat-name/nested/>Nested</a></ul></div><h3 class=collapsible-section>programming</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/bresenham-s-line-algorithm/>Bresenham's Line Algorithm</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/cpp-deep-dive/>Cpp Deep Dive</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/docker-stuff/>Docker Stuff</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/git-deep-dive/>Git Deep Dive</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/git-stuff/>Git Stuff</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/nice-fonts/>Nice Fonts</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/regex-cheatsheet/>RegEx Cheatsheet</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/rust-tips/>Rust Tips</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/vscode-devcontainers/>VSCode DevContainers</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/windows-wsl-programmer-s-setup/>Windows + WSL Programmer's Setup</a></ul></div><h4 class=collapsible-section>ðŸ‘‰Python</h4><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/advanced-numpy/>Advanced Numpy</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/python/>Python</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/python-advanced-typings/>Python Advanced Typings</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/python-imports/>Python Imports</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/python-regex/>Python RegEx</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/python-strings/>Python Strings</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/programming/python/pytorch-notes/>Pytorch Notes</a></ul></div><h3 class=collapsible-section>tech</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/google-chrome-and-google-search-hacks/>Google Chrome And Google Search Hacks</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/make-conda-great-less-suckish-again/>Make Conda Great (Less Suckish) Again</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/microsoft-windows-productivity-hacks-and-tricks/>Microsoft Windows Productivity Hacks And Tricks</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/personal-notes-on-consumer-electronics/>Personal Notes On Consumer Electronics</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/running-custom-command-using-windows-shortcuts/>Running Custom Command Using Windows Shortcuts</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/saving-pulsesecure-password-in-microsoft-windows/>Saving PulseSecure Password In Microsoft Windows</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/ssh-into-a-wsl2-host-remotely/>SSH Into A WSL2 Host Remotely</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/ubuntu-ssh-machine-learning-server-setup/>Ubuntu SSH Machine Learning Server Setup</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/vscode-resources/>VSCode Resources</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/tech/wsl2-nvidia-docker-error/>WSL2 NVIDIA Docker Error</a></ul></div><h3 class=collapsible-section>university</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/university/analog-electronics/>Analog Electronics</a><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/university/fyp-plan-trying-to-break-things/>FYP Plan (Trying To Break Things)````</a></ul></div><h3 class=collapsible-section>website development</h3><div class=collapsible-wrapper><ul class=list-unstyled><li><a class=docs-link href=https://obsidian-zola.trwbox.com/docs/website-development/seo/>SEO</a></ul></div></nav></div><nav aria-label="Secondary navigation" class="docs-toc d-none d-xl-block col-xl-3"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>ESP32 Hardware Timer Interrupt</h1><p>In ESP32-IDF < v5.0, we can only use the <code>driver/timer.h</code>:<pre class=language-cpp data-lang=cpp style=background-color:#2b303b;color:#c0c5ce;><code class=language-cpp data-lang=cpp><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>stdio.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>stdlib.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>math.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>assert.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>freertos/FreeRTOS.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>freertos/task.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>freertos/queue.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>driver/gpio.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>driver/dac.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>driver/timer.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>esp_log.h</span><span>"
</span><span>
</span><span style=color:#65737e;>/*  The timer ISR has an execution time of 5.5 micro-seconds(us).
</span><span style=color:#65737e;>    Therefore, a timer period less than 5.5 us will cause trigger the interrupt watchdog.
</span><span style=color:#65737e;>    7 us is a safe interval that will not trigger the watchdog. No need to customize it.
</span><span style=color:#65737e;>*/
</span><span>
</span><span style=color:#b48ead;>#define </span><span>WITH_RELOAD            </span><span style=color:#d08770;>1
</span><span style=color:#b48ead;>#define </span><span>TIMER_INTR_US          </span><span style=color:#d08770;>7 </span><span style=color:#65737e;>// Execution time of each ISR interval in micro-seconds
</span><span style=color:#b48ead;>#define </span><span>TIMER_DIVIDER          </span><span style=color:#d08770;>16
</span><span style=color:#b48ead;>#define </span><span>POINT_ARR_LEN          </span><span style=color:#d08770;>200 </span><span style=color:#65737e;>// Length of points array
</span><span style=color:#b48ead;>#define </span><span>AMP_DAC                </span><span style=color:#d08770;>255 </span><span style=color:#65737e;>// Amplitude of DAC voltage. If it's more than 256 will causes dac_output_voltage() output 0.
</span><span style=color:#b48ead;>#define </span><span>VDD                    </span><span style=color:#d08770;>3300 </span><span style=color:#65737e;>// VDD is 3.3V, 3300mV
</span><span style=color:#b48ead;>#define </span><span>CONST_PERIOD_2_PI      </span><span style=color:#d08770;>6.2832
</span><span style=color:#b48ead;>#define </span><span style=color:#8fa1b3;>SEC_TO_MICRO_SEC</span><span>(</span><span style=color:#bf616a;>x</span><span>)    ((x) / </span><span style=color:#d08770;>1000 </span><span>/ </span><span style=color:#d08770;>1000</span><span>) </span><span style=color:#65737e;>// Convert second to micro-second
</span><span style=color:#b48ead;>#define </span><span>UNUSED_PARAM           </span><span style=color:#b48ead;>__attribute__</span><span>((unused)) </span><span style=color:#65737e;>// A const period parameter which equals 2 * pai, used to calculate raw dac output value.
</span><span style=color:#b48ead;>#define </span><span>TIMER_TICKS            (TIMER_BASE_CLK / TIMER_DIVIDER)     </span><span style=color:#65737e;>// TIMER_BASE_CLK = APB_CLK = 80MHz
</span><span style=color:#b48ead;>#define </span><span>ALARM_VAL_US           </span><span style=color:#bf616a;>SEC_TO_MICRO_SEC</span><span>(TIMER_INTR_US * TIMER_TICKS)     </span><span style=color:#65737e;>// Alarm value in micro-seconds
</span><span style=color:#b48ead;>#define </span><span>OUTPUT_POINT_NUM       (</span><span style=color:#b48ead;>int</span><span>)(</span><span style=color:#d08770;>1000000 </span><span>/ (TIMER_INTR_US * FREQ) + </span><span style=color:#d08770;>0.5</span><span>)     </span><span style=color:#65737e;>// The number of output wave points.
</span><span>
</span><span style=color:#b48ead;>#define </span><span>DAC_CHAN               CONFIG_EXAMPLE_DAC_CHANNEL           </span><span style=color:#65737e;>// DAC_CHANNEL_1 (GPIO25) by default
</span><span style=color:#b48ead;>#define </span><span>FREQ                   CONFIG_EXAMPLE_WAVE_FREQUENCY        </span><span style=color:#65737e;>// 3kHz by default
</span><span>
</span><span style=color:#bf616a;>_Static_assert</span><span>(OUTPUT_POINT_NUM <= POINT_ARR_LEN, "</span><span style=color:#a3be8c;>The CONFIG_EXAMPLE_WAVE_FREQUENCY is too low and using too long buffer.</span><span>");
</span><span>
</span><span style=color:#b48ead;>static int</span><span> raw_val[POINT_ARR_LEN];                      </span><span style=color:#65737e;>// Used to store raw values
</span><span style=color:#b48ead;>static int</span><span> volt_val[POINT_ARR_LEN];                    </span><span style=color:#65737e;>// Used to store voltage values(in mV)
</span><span style=color:#b48ead;>static const char </span><span>*TAG = "</span><span style=color:#a3be8c;>wave_gen</span><span>";
</span><span>
</span><span style=color:#b48ead;>static int</span><span> g_index = </span><span style=color:#d08770;>0</span><span>;
</span><span>
</span><span style=color:#65737e;>/* Timer interrupt service routine */
</span><span style=color:#b48ead;>static void</span><span> IRAM_ATTR </span><span style=color:#8fa1b3;>timer0_ISR</span><span>(</span><span style=color:#b48ead;>void </span><span>*</span><span style=color:#bf616a;>ptr</span><span>)
</span><span>{
</span><span>    </span><span style=color:#bf616a;>timer_group_clr_intr_status_in_isr</span><span>(TIMER_GROUP_0, TIMER_0);
</span><span>    </span><span style=color:#bf616a;>timer_group_enable_alarm_in_isr</span><span>(TIMER_GROUP_0, TIMER_0);
</span><span>
</span><span>    </span><span style=color:#b48ead;>int </span><span>*head = (</span><span style=color:#b48ead;>int</span><span>*)ptr;
</span><span>
</span><span>    </span><span style=color:#65737e;>/* DAC output ISR has an execution time of 4.4 us*/
</span><span>    </span><span style=color:#b48ead;>if </span><span>(g_index >= OUTPUT_POINT_NUM) g_index = </span><span style=color:#d08770;>0</span><span>;
</span><span>    </span><span style=color:#bf616a;>dac_output_voltage</span><span>(DAC_CHAN, *(head + g_index));
</span><span>    g_index++;
</span><span>}
</span><span>
</span><span style=color:#65737e;>/* Timer group0 TIMER_0 initialization */
</span><span style=color:#b48ead;>static void </span><span style=color:#8fa1b3;>example_timer_init</span><span>(</span><span style=color:#b48ead;>int </span><span style=color:#bf616a;>timer_idx</span><span>, </span><span style=color:#b48ead;>bool </span><span style=color:#bf616a;>auto_reload</span><span>)
</span><span>{
</span><span>    esp_err_t ret;
</span><span>    timer_config_t config = {
</span><span>        .</span><span style=color:#bf616a;>divider </span><span>= TIMER_DIVIDER,
</span><span>        .</span><span style=color:#bf616a;>counter_dir </span><span>= TIMER_COUNT_UP,
</span><span>        .</span><span style=color:#bf616a;>counter_en </span><span>= TIMER_PAUSE,
</span><span>        .</span><span style=color:#bf616a;>alarm_en </span><span>= TIMER_ALARM_EN,
</span><span>        .</span><span style=color:#bf616a;>intr_type </span><span>= TIMER_INTR_LEVEL,
</span><span>        .</span><span style=color:#bf616a;>auto_reload </span><span>= auto_reload,
</span><span>    };
</span><span>
</span><span>    ret = </span><span style=color:#bf616a;>timer_init</span><span>(TIMER_GROUP_0, timer_idx, &config);
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(ret);
</span><span>    ret = </span><span style=color:#bf616a;>timer_set_counter_value</span><span>(TIMER_GROUP_0, timer_idx, </span><span style=color:#d08770;>0x00000000</span><span style=color:#b48ead;>ULL</span><span>);
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(ret);
</span><span>    ret = </span><span style=color:#bf616a;>timer_set_alarm_value</span><span>(TIMER_GROUP_0, timer_idx, ALARM_VAL_US);
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(ret);
</span><span>    ret = </span><span style=color:#bf616a;>timer_enable_intr</span><span>(TIMER_GROUP_0, TIMER_0);
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(ret);
</span><span>    </span><span style=color:#65737e;>/* Register an ISR handler */
</span><span>    </span><span style=color:#bf616a;>timer_isr_register</span><span>(TIMER_GROUP_0, timer_idx, timer0_ISR, (</span><span style=color:#b48ead;>void </span><span>*)raw_val, </span><span style=color:#d08770;>0</span><span>, </span><span style=color:#d08770;>NULL</span><span>);
</span><span>}
</span><span>
</span><span> </span><span style=color:#b48ead;>static void </span><span style=color:#8fa1b3;>prepare_data</span><span>(</span><span style=color:#b48ead;>int </span><span style=color:#bf616a;>pnt_num</span><span>)
</span><span>{
</span><span>    </span><span style=color:#bf616a;>timer_pause</span><span>(TIMER_GROUP_0, TIMER_0);
</span><span>    </span><span style=color:#b48ead;>for </span><span>(</span><span style=color:#b48ead;>int</span><span> i = </span><span style=color:#d08770;>0</span><span>; i < pnt_num; i ++) {
</span><span>        </span><span style=color:#b48ead;>#ifdef</span><span> CONFIG_EXAMPLE_WAVEFORM_SINE
</span><span>            raw_val[i] = (</span><span style=color:#b48ead;>int</span><span>)((</span><span style=color:#96b5b4;>sin</span><span>( i * CONST_PERIOD_2_PI / pnt_num) + </span><span style=color:#d08770;>1</span><span>) * (</span><span style=color:#b48ead;>double</span><span>)(AMP_DAC)/</span><span style=color:#d08770;>2 </span><span>+ </span><span style=color:#d08770;>0.5</span><span>);
</span><span>        </span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_TRIANGLE
</span><span>            raw_val[i] = (i > (pnt_num/</span><span style=color:#d08770;>2</span><span>)) ? (</span><span style=color:#d08770;>2 </span><span>* AMP_DAC * (pnt_num - i) / pnt_num) : (</span><span style=color:#d08770;>2 </span><span>* AMP_DAC * i / pnt_num);
</span><span>        </span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SAWTOOTH
</span><span>            raw_val[i] = (i == pnt_num) ? </span><span style=color:#d08770;>0 </span><span>: (i * AMP_DAC / pnt_num);
</span><span>        </span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SQUARE
</span><span>            raw_val[i] = (i < (pnt_num/</span><span style=color:#d08770;>2</span><span>)) ? AMP_DAC : </span><span style=color:#d08770;>0</span><span>;
</span><span>        </span><span style=color:#b48ead;>#endif
</span><span>        volt_val[i] = (</span><span style=color:#b48ead;>int</span><span>)(VDD * raw_val[i] / (</span><span style=color:#b48ead;>float</span><span>)AMP_DAC);
</span><span>    }
</span><span>    </span><span style=color:#bf616a;>timer_start</span><span>(TIMER_GROUP_0, TIMER_0);
</span><span>}
</span><span>
</span><span style=color:#b48ead;>static void </span><span style=color:#8fa1b3;>log_info</span><span>(</span><span style=color:#b48ead;>void</span><span>)
</span><span>{
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>DAC output channel: </span><span style=color:#d08770;>%d</span><span>", DAC_CHAN);
</span><span>    </span><span style=color:#b48ead;>if </span><span>(DAC_CHAN == DAC_CHANNEL_1) {
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>GPIO:</span><span style=color:#d08770;>%d</span><span>", GPIO_NUM_25);
</span><span>    } </span><span style=color:#b48ead;>else </span><span>{
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>GPIO:</span><span style=color:#d08770;>%d</span><span>", GPIO_NUM_26);
</span><span>    }
</span><span>    </span><span style=color:#b48ead;>#ifdef</span><span> CONFIG_EXAMPLE_WAVEFORM_SINE
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: SINE</span><span>");
</span><span>    </span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_TRIANGLE
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: TRIANGLE</span><span>");
</span><span>    </span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SAWTOOTH
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: SAWTOOTH</span><span>");
</span><span>    </span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SQUARE
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: SQUARE</span><span>");
</span><span>    </span><span style=color:#b48ead;>#endif
</span><span>
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Frequency(Hz): </span><span style=color:#d08770;>%d</span><span>", FREQ);
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Output points num: </span><span style=color:#d08770;>%d</span><span style=color:#96b5b4;>\n</span><span>", OUTPUT_POINT_NUM);
</span><span>}
</span><span>
</span><span style=color:#b48ead;>void </span><span style=color:#8fa1b3;>app_main</span><span>(</span><span style=color:#b48ead;>void</span><span>)
</span><span>{
</span><span>    esp_err_t ret;
</span><span>    </span><span style=color:#bf616a;>example_timer_init</span><span>(TIMER_0, WITH_RELOAD);
</span><span>
</span><span>    ret = </span><span style=color:#bf616a;>dac_output_enable</span><span>(DAC_CHAN);
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(ret);
</span><span>
</span><span>    </span><span style=color:#bf616a;>log_info</span><span>();
</span><span>    g_index = </span><span style=color:#d08770;>0</span><span>;
</span><span>    </span><span style=color:#bf616a;>prepare_data</span><span>(OUTPUT_POINT_NUM);
</span><span>
</span><span>    </span><span style=color:#b48ead;>while</span><span>(</span><span style=color:#d08770;>1</span><span>) {
</span><span>        </span><span style=color:#bf616a;>vTaskDelay</span><span>(</span><span style=color:#d08770;>10</span><span>);
</span><span>        </span><span style=color:#b48ead;>#if</span><span> CONFIG_EXAMPLE_LOG_VOLTAGE
</span><span>            </span><span style=color:#b48ead;>if </span><span>(g_index < OUTPUT_POINT_NUM) {
</span><span>                </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Output voltage(mV): </span><span style=color:#d08770;>%d</span><span>", volt_val[g_index]);
</span><span>                </span><span style=color:#bf616a;>ESP_LOGD</span><span>(TAG, "</span><span style=color:#a3be8c;>g_index: </span><span style=color:#d08770;>%d</span><span style=color:#96b5b4;>\n</span><span>", g_index);
</span><span>            }
</span><span>        </span><span style=color:#b48ead;>#endif
</span><span>    }
</span><span>}
</span></code></pre><p>After ESP-IDF v5.0:<pre class=language-cpp data-lang=cpp style=background-color:#2b303b;color:#c0c5ce;><code class=language-cpp data-lang=cpp><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>stdio.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>stdlib.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>math.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span><</span><span style=color:#a3be8c;>assert.h</span><span>>
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>freertos/FreeRTOS.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>freertos/task.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>freertos/queue.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>driver/gpio.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>driver/dac.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>driver/gptimer.h</span><span>"
</span><span style=color:#b48ead;>#include </span><span>"</span><span style=color:#a3be8c;>esp_log.h</span><span>"
</span><span>
</span><span style=color:#65737e;>/*  The timer ISR has an execution time of 5.5 micro-seconds(us).
</span><span style=color:#65737e;>    Therefore, a timer period less than 5.5 us will cause trigger the interrupt watchdog.
</span><span style=color:#65737e;>    7 us is a safe interval that will not trigger the watchdog. No need to customize it.
</span><span style=color:#65737e;>*/
</span><span>
</span><span style=color:#b48ead;>#define </span><span>TIMER_INTR_US          </span><span style=color:#d08770;>7                                    </span><span style=color:#65737e;>// Execution time of each ISR interval in micro-seconds
</span><span style=color:#b48ead;>#define </span><span>POINT_ARR_LEN          </span><span style=color:#d08770;>200                                  </span><span style=color:#65737e;>// Length of points array
</span><span style=color:#b48ead;>#define </span><span>AMP_DAC                </span><span style=color:#d08770;>255                                  </span><span style=color:#65737e;>// Amplitude of DAC voltage. If it's more than 256 will causes dac_output_voltage() output 0.
</span><span style=color:#b48ead;>#define </span><span>VDD                    </span><span style=color:#d08770;>3300                                 </span><span style=color:#65737e;>// VDD is 3.3V, 3300mV
</span><span style=color:#b48ead;>#define </span><span>CONST_PERIOD_2_PI      </span><span style=color:#d08770;>6.2832
</span><span style=color:#b48ead;>#define </span><span>DAC_CHAN               CONFIG_EXAMPLE_DAC_CHANNEL           </span><span style=color:#65737e;>// DAC_CHANNEL_1 (GPIO25) by default
</span><span style=color:#b48ead;>#define </span><span>FREQ                   CONFIG_EXAMPLE_WAVE_FREQUENCY        </span><span style=color:#65737e;>// 3kHz by default
</span><span style=color:#b48ead;>#define </span><span>OUTPUT_POINT_NUM       (</span><span style=color:#b48ead;>int</span><span>)(</span><span style=color:#d08770;>1000000 </span><span>/ (TIMER_INTR_US * FREQ) + </span><span style=color:#d08770;>0.5</span><span>)     </span><span style=color:#65737e;>// The number of output wave points.
</span><span>
</span><span style=color:#bf616a;>_Static_assert</span><span>(OUTPUT_POINT_NUM <= POINT_ARR_LEN, "</span><span style=color:#a3be8c;>The CONFIG_EXAMPLE_WAVE_FREQUENCY is too low and using too long buffer.</span><span>");
</span><span>
</span><span style=color:#b48ead;>static int</span><span> raw_val[POINT_ARR_LEN];                      </span><span style=color:#65737e;>// Used to store raw values
</span><span style=color:#b48ead;>static int</span><span> volt_val[POINT_ARR_LEN];                    </span><span style=color:#65737e;>// Used to store voltage values(in mV)
</span><span style=color:#b48ead;>static const char </span><span>*TAG = "</span><span style=color:#a3be8c;>wave_gen</span><span>";
</span><span>
</span><span style=color:#b48ead;>static int</span><span> g_index = </span><span style=color:#d08770;>0</span><span>;
</span><span>
</span><span style=color:#65737e;>/* Timer interrupt service routine */
</span><span style=color:#b48ead;>static bool</span><span> IRAM_ATTR </span><span style=color:#8fa1b3;>on_timer_alarm_cb</span><span>(gptimer_handle_t </span><span style=color:#bf616a;>timer</span><span>, </span><span style=color:#b48ead;>const</span><span> gptimer_alarm_event_data_t *</span><span style=color:#bf616a;>edata</span><span>, </span><span style=color:#b48ead;>void </span><span>*</span><span style=color:#bf616a;>user_data</span><span>)
</span><span>{
</span><span>    </span><span style=color:#b48ead;>int </span><span>*head = (</span><span style=color:#b48ead;>int </span><span>*)user_data;
</span><span>
</span><span>    </span><span style=color:#65737e;>/* DAC output ISR has an execution time of 4.4 us*/
</span><span>    </span><span style=color:#b48ead;>if </span><span>(g_index >= OUTPUT_POINT_NUM) {
</span><span>        g_index = </span><span style=color:#d08770;>0</span><span>;
</span><span>    }
</span><span>    </span><span style=color:#bf616a;>dac_output_voltage</span><span>(DAC_CHAN, *(head + g_index));
</span><span>    g_index++;
</span><span>    </span><span style=color:#b48ead;>return </span><span style=color:#d08770;>false</span><span>;
</span><span>}
</span><span>
</span><span style=color:#b48ead;>static void </span><span style=color:#8fa1b3;>prepare_data</span><span>(</span><span style=color:#b48ead;>int </span><span style=color:#bf616a;>pnt_num</span><span>)
</span><span>{
</span><span>    </span><span style=color:#b48ead;>for </span><span>(</span><span style=color:#b48ead;>int</span><span> i = </span><span style=color:#d08770;>0</span><span>; i < pnt_num; i ++) {
</span><span style=color:#b48ead;>#ifdef</span><span> CONFIG_EXAMPLE_WAVEFORM_SINE
</span><span>        raw_val[i] = (</span><span style=color:#b48ead;>int</span><span>)((</span><span style=color:#96b5b4;>sin</span><span>( i * CONST_PERIOD_2_PI / pnt_num) + </span><span style=color:#d08770;>1</span><span>) * (</span><span style=color:#b48ead;>double</span><span>)(AMP_DAC) / </span><span style=color:#d08770;>2 </span><span>+ </span><span style=color:#d08770;>0.5</span><span>);
</span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_TRIANGLE
</span><span>        raw_val[i] = (i > (pnt_num / </span><span style=color:#d08770;>2</span><span>)) ? (</span><span style=color:#d08770;>2 </span><span>* AMP_DAC * (pnt_num - i) / pnt_num) : (</span><span style=color:#d08770;>2 </span><span>* AMP_DAC * i / pnt_num);
</span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SAWTOOTH
</span><span>        raw_val[i] = (i == pnt_num) ? </span><span style=color:#d08770;>0 </span><span>: (i * AMP_DAC / pnt_num);
</span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SQUARE
</span><span>        raw_val[i] = (i < (pnt_num / </span><span style=color:#d08770;>2</span><span>)) ? AMP_DAC : </span><span style=color:#d08770;>0</span><span>;
</span><span style=color:#b48ead;>#endif
</span><span>        volt_val[i] = (</span><span style=color:#b48ead;>int</span><span>)(VDD * raw_val[i] / (</span><span style=color:#b48ead;>float</span><span>)AMP_DAC);
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#b48ead;>static void </span><span style=color:#8fa1b3;>log_info</span><span>(</span><span style=color:#b48ead;>void</span><span>)
</span><span>{
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>DAC output channel: </span><span style=color:#d08770;>%d</span><span>", DAC_CHAN);
</span><span>    </span><span style=color:#b48ead;>if </span><span>(DAC_CHAN == DAC_CHANNEL_1) {
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>GPIO:</span><span style=color:#d08770;>%d</span><span>", GPIO_NUM_25);
</span><span>    } </span><span style=color:#b48ead;>else </span><span>{
</span><span>        </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>GPIO:</span><span style=color:#d08770;>%d</span><span>", GPIO_NUM_26);
</span><span>    }
</span><span style=color:#b48ead;>#ifdef</span><span> CONFIG_EXAMPLE_WAVEFORM_SINE
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: SINE</span><span>");
</span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_TRIANGLE
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: TRIANGLE</span><span>");
</span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SAWTOOTH
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: SAWTOOTH</span><span>");
</span><span style=color:#b48ead;>#elif</span><span> CONFIG_EXAMPLE_WAVEFORM_SQUARE
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Waveform: SQUARE</span><span>");
</span><span style=color:#b48ead;>#endif
</span><span>
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Frequency(Hz): </span><span style=color:#d08770;>%d</span><span>", FREQ);
</span><span>    </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Output points num: </span><span style=color:#d08770;>%d</span><span style=color:#96b5b4;>\n</span><span>", OUTPUT_POINT_NUM);
</span><span>}
</span><span>
</span><span style=color:#b48ead;>void </span><span style=color:#8fa1b3;>app_main</span><span>(</span><span style=color:#b48ead;>void</span><span>)
</span><span>{
</span><span>    g_index = </span><span style=color:#d08770;>0</span><span>;
</span><span>    gptimer_handle_t gptimer = </span><span style=color:#d08770;>NULL</span><span>;
</span><span>    gptimer_config_t timer_config = {
</span><span>        .</span><span style=color:#bf616a;>clk_src </span><span>= GPTIMER_CLK_SRC_APB,
</span><span>        .</span><span style=color:#bf616a;>direction </span><span>= GPTIMER_COUNT_UP,
</span><span>        .</span><span style=color:#bf616a;>resolution_hz </span><span>= </span><span style=color:#d08770;>1000000</span><span>, </span><span style=color:#65737e;>// 1MHz, 1 tick = 1us
</span><span>    };
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(</span><span style=color:#bf616a;>gptimer_new_timer</span><span>(&timer_config, &gptimer));
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(</span><span style=color:#bf616a;>dac_output_enable</span><span>(DAC_CHAN));
</span><span>
</span><span>    </span><span style=color:#bf616a;>log_info</span><span>();
</span><span>    </span><span style=color:#bf616a;>prepare_data</span><span>(OUTPUT_POINT_NUM);
</span><span>
</span><span>    gptimer_alarm_config_t alarm_config = {
</span><span>        .</span><span style=color:#bf616a;>reload_count </span><span>= </span><span style=color:#d08770;>0</span><span>,
</span><span>        .</span><span style=color:#bf616a;>alarm_count </span><span>= TIMER_INTR_US,
</span><span>        .</span><span style=color:#bf616a;>flags</span><span>.</span><span style=color:#bf616a;>auto_reload_on_alarm </span><span>= </span><span style=color:#d08770;>true</span><span>,
</span><span>    };
</span><span>    gptimer_event_callbacks_t cbs = {
</span><span>        .</span><span style=color:#bf616a;>on_alarm </span><span>= on_timer_alarm_cb,
</span><span>    };
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(</span><span style=color:#bf616a;>gptimer_register_event_callbacks</span><span>(gptimer, &cbs, raw_val));
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(</span><span style=color:#bf616a;>gptimer_set_alarm_action</span><span>(gptimer, &alarm_config));
</span><span>    </span><span style=color:#bf616a;>ESP_ERROR_CHECK</span><span>(</span><span style=color:#bf616a;>gptimer_start</span><span>(gptimer));
</span><span>
</span><span>    </span><span style=color:#b48ead;>while </span><span>(</span><span style=color:#d08770;>1</span><span>) {
</span><span>        </span><span style=color:#bf616a;>vTaskDelay</span><span>(</span><span style=color:#d08770;>10</span><span>);
</span><span style=color:#b48ead;>#if</span><span> CONFIG_EXAMPLE_LOG_VOLTAGE
</span><span>        </span><span style=color:#b48ead;>if </span><span>(g_index < OUTPUT_POINT_NUM) {
</span><span>            </span><span style=color:#bf616a;>ESP_LOGI</span><span>(TAG, "</span><span style=color:#a3be8c;>Output voltage(mV): </span><span style=color:#d08770;>%d</span><span>", volt_val[g_index]);
</span><span>            </span><span style=color:#bf616a;>ESP_LOGD</span><span>(TAG, "</span><span style=color:#a3be8c;>g_index: </span><span style=color:#d08770;>%d</span><span style=color:#96b5b4;>\n</span><span>", g_index);
</span><span>        }
</span><span style=color:#b48ead;>#endif
</span><span>    }
</span><span>}
</span></code></pre><div class=docs-graph id=graph></div></main></div></div></div><script integrity="sha512-XHDcSyqhOoO2ocB7sKOCJEkUjw/pQCJViP1ynpy+EGh/LggzrP6U/V3a++LQTnZT7sCQKeHRyWHfhN2afjXjCg==" crossorigin=anonymous referrerpolicy=no-referrer src=https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js></script><script defer src=https://obsidian-zola.trwbox.com/js/graph_info.js></script><script defer src=https://obsidian-zola.trwbox.com/js/graph.js></script><script defer src=https://obsidian-zola.trwbox.com/js/settings.js></script><script defer src=https://obsidian-zola.trwbox.com/js/main.js></script><script defer src=https://obsidian-zola.trwbox.com/plugins/elasticlunr.min.js></script><script defer src=https://obsidian-zola.trwbox.com/search_index.en.js></script><script defer src=https://obsidian-zola.trwbox.com/js/search.js></script>